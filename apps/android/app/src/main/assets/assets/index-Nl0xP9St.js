var e=Object.defineProperty,a=Object.defineProperties,r=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,n=(a,r,o)=>r in a?e(a,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[r]=o,i=(e,a)=>{for(var r in a||(a={}))t.call(a,r)&&n(e,r,a[r]);if(o)for(var r of o(a))l.call(a,r)&&n(e,r,a[r]);return e},s=(e,o)=>a(e,r(o)),c=(e,a)=>{var r={};for(var n in e)t.call(e,n)&&a.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&o)for(var n of o(e))a.indexOf(n)<0&&l.call(e,n)&&(r[n]=e[n]);return r};import{y as d,c as m,R as u,i as f,j as h,k as p,l as v,n as g,m as _,u as b,o as y,M,A as k,H as w,D as C,q as j,G as x,w as I,h as S,p as N,r as O,s as z,S as A,g as q,f as W,P as F,a as H}from"./index-XyJYIhAT.js";import{P as B}from"./PullToRefresh-F0PnwmxX.js";import{P}from"./PanelHeaderWithBack-Mte7KJTI.js";import{V as T,a as V}from"./colors-rNCG9YyA.js";import{m as D,I as L,h as G}from"./makeRequest-t21nFAea.js";import{u as J}from"./useRateLimitExceeded-afZtobbp.js";import{u as R}from"./useSnackbar-Q4lCaM24.js";import{H as E}from"./HorizontalScroll-pkeOEJmx.js";import{C as $}from"./Card-SOVpxpsd.js";import{C as U}from"./CardGrid-pEh1ThRX.js";import{A as K}from"./Avatar-J1FZQEiI.js";import{w as Q}from"./winx48-J7pHJFzG.js";import"./chevron_24-u9G6Q-o1.js";const X="_Gradient_1jdh2_1",Y="_Gradient--to-bottom_1jdh2_5",Z="_Gradient--mode-tint_1jdh2_9",ee=e=>{var a=e,{mode:r="default",to:o="top"}=a,t=c(a,["mode","to"]);return d(u,s(i({role:"presentation"},t),{baseClassName:m(X,"default"!==r&&Z,"bottom"===o&&Y)}))},ae="_MiniInfoCell_1qpji_1",re="_MiniInfoCell__before_1qpji_12",oe="_MiniInfoCell__middle_1qpji_18",te="_MiniInfoCell__content_1qpji_26",le="_MiniInfoCell__after_1qpji_52",ne={add:"_MiniInfoCell--mode-add_1qpji_58",accent:"_MiniInfoCell--mode-accent_1qpji_8",more:"_MiniInfoCell--mode-more_1qpji_59"},ie={nowrap:"_MiniInfoCell--textWrap-nowrap_1qpji_48",full:"_MiniInfoCell--textWrap-full_1qpji_43",short:"_MiniInfoCell--textWrap-short_1qpji_35"},se=e=>{var a=e,{before:r,after:o,children:t,mode:l="base",textWrap:n="nowrap",expandable:_=!1,className:b}=a,y=c(a,["before","after","children","mode","textWrap","expandable","className"]);const M=m(ae,ie[n],"base"!==l&&ne[l],b),k=d(v,null,f(r)&&d("span",{className:re},r),d("div",{className:oe},d(h,{className:te,weight:"more"===l?"2":void 0},t),_&&d(p,null)),f(o)&&d("span",{className:le},o));return y.onClick?d(g,s(i({Component:"div",role:"button"},y),{className:M}),k):d(u,s(i({},y),{baseClassName:M}),k)};var ce=_("Icon20EducationOutline","education_outline_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" id="education_outline_20"><g fill="none" fill-rule="evenodd"><path d="M0 0h20v20H0z" /><path fill="currentColor" fill-rule="nonzero" d="m17.5 9.063-1.5.822V13c0 2.8-2.717 5-6 5s-6-2.2-6-5V9.885L1.649 8.596a1.25 1.25 0 0 1 0-2.192l7.75-4.25a1.25 1.25 0 0 1 1.202 0l7.75 4.25c.424.232.66.674.649 1.125v5.221a.75.75 0 1 1-1.5 0zm-3 1.645-3.899 2.138a1.25 1.25 0 0 1-1.202 0L5.5 10.708V13c0 1.894 1.984 3.5 4.5 3.5s4.5-1.606 4.5-3.5zM10 3.535 2.77 7.5 10 11.465 17.23 7.5z" /></g></symbol>',20,20,!1,void 0),de=_("Icon20IncognitoOutline","incognito_outline_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20" id="incognito_outline_20"><path fill-rule="evenodd" d="M8.414 2h3.172c.455 0 .838 0 1.154.024.332.025.644.079.948.215.471.21.874.549 1.162.977.186.276.293.575.374.897.078.308.143.685.221 1.133L15.925 8h1.825a.75.75 0 0 1 0 1.5H2.25a.75.75 0 0 1 0-1.5h1.826l.479-2.754c.078-.448.143-.825.22-1.133.082-.322.189-.62.375-.897a2.75 2.75 0 0 1 1.162-.977c.304-.136.616-.19.948-.215C7.576 2 7.96 2 8.414 2M5.598 8h8.804l-.43-2.47a16 16 0 0 0-.202-1.05c-.06-.236-.113-.35-.165-.427a1.25 1.25 0 0 0-.528-.445c-.085-.037-.206-.07-.45-.088-.253-.02-.579-.02-1.069-.02H8.443c-.49 0-.816 0-1.07.02-.243.018-.364.05-.449.088a1.25 1.25 0 0 0-.528.445c-.052.077-.105.19-.165.428-.062.246-.118.567-.202 1.05zM5.5 12.5a2 2 0 1 0 0 4 2 2 0 0 0 0-4m-3.5 2a3.5 3.5 0 0 1 6.74-1.325A5 5 0 0 1 10 13c.45 0 .877.077 1.26.175a3.501 3.501 0 1 1-.256 1.483A3.8 3.8 0 0 0 10 14.5a3.8 3.8 0 0 0-1.004.159A3.5 3.5 0 0 1 2 14.5m12.5-2a2 2 0 1 0 0 4 2 2 0 0 0 0-4" clip-rule="evenodd" /></symbol>',20,20,!1,void 0),me=_("Icon20StatisticsOutline","statistics_outline_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20" id="statistics_outline_20"><path fill="currentColor" fill-rule="evenodd" d="M17 3.75a.75.75 0 0 0-.75-.75h-3.5a.75.75 0 0 0 0 1.5h1.69L10.5 8.44 9.03 6.97a.75.75 0 0 0-1.06 0l-4.75 4.75a.75.75 0 1 0 1.06 1.06L8.5 8.56l1.47 1.47a.75.75 0 0 0 1.06 0l4.47-4.47v1.69a.75.75 0 0 0 1.5 0zM2 16.25a.75.75 0 0 1 .75-.75h14.5a.75.75 0 0 1 0 1.5H2.75a.75.75 0 0 1-.75-.75" clip-rule="evenodd" /></symbol>',20,20,!1,void 0),ue=_("Icon28BrainOutline","brain_outline_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 28 28" id="brain_outline_28"><g fill="currentColor" fill-rule="evenodd" clip-rule="evenodd"><path d="M11.18 6.016a1 1 0 0 0-1.163.803c-.072.387-.58 1.207-1.999 1.18a1 1 0 0 0-.036 2c2.348.043 3.745-1.422 4.002-2.818a1 1 0 0 0-.803-1.165M17.266 7.028a1 1 0 0 1 1.206.737c.158.655.392 1.266.761 1.68.318.354.79.63 1.662.537a1 1 0 1 1 .21 1.99c-1.5.158-2.608-.351-3.362-1.195-.703-.786-1.033-1.788-1.215-2.542a1 1 0 0 1 .737-1.207M10.569 21.498a1 1 0 0 1-1.067-.929c-.047-.683-.17-1.25-.478-1.738-.3-.475-.837-.977-1.897-1.403a1 1 0 1 1 .746-1.856c1.364.548 2.274 1.29 2.843 2.193.56.89.724 1.836.782 2.666a1 1 0 0 1-.929 1.067" /><path d="M10.017 6.82a1 1 0 1 1 1.967.36c-.257 1.397-1.654 2.863-4.002 2.82a1 1 0 0 1 .036-2c1.419.026 1.927-.794 1.998-1.18m-.515 13.749a1 1 0 1 0 1.996-.138c-.058-.83-.221-1.776-.782-2.666-.568-.903-1.479-1.645-2.843-2.193a1 1 0 1 0-.746 1.856c1.06.426 1.598.928 1.897 1.403.307.488.431 1.055.478 1.738" /><path d="M11.624 2c-2.03 0-3.765 1.21-4.58 2.938C4.676 5.656 3 7.955 3 10.608c0 1.205.344 2.332.94 3.272a4.05 4.05 0 0 0-.843 2.486c0 1.422.726 2.701 1.85 3.396a3.5 3.5 0 0 0-.075.72c0 1.803 1.46 3.41 3.307 3.352C8.89 25.12 10.241 26 11.811 26c.807 0 1.56-.234 2.196-.637a4.2 4.2 0 0 0 2.225.637 4.22 4.22 0 0 0 3.719-2.237c1.767-.023 3.11-1.521 3.11-3.262q-.001-.395-.086-.765C24.195 19.064 25 17.732 25 16.24c0-.985-.348-1.893-.93-2.592a6.2 6.2 0 0 0 .806-2.596 6 6 0 0 0 .022-.53c0-2.633-1.611-4.911-3.913-5.75A5.46 5.46 0 0 0 16.241 2c-.844 0-1.645.193-2.36.538A5 5 0 0 0 11.625 2m0 2c-1.325 0-2.473.868-2.9 2.11a1 1 0 0 1-.757.658C6.324 7.083 5 8.643 5 10.608c0 .73.185 1.408.502 1.988q.13-.072.261-.137c1.29-.63 2.88-.807 4.209-.349a1 1 0 0 1-.651 1.891c-.752-.259-1.79-.18-2.68.255-.815.399-1.544 1.156-1.544 2.11 0 .96.62 1.702 1.362 1.892a1 1 0 0 1 .613 1.478c-.124.211-.2.465-.2.746 0 .808.6 1.354 1.21 1.354q.194-.001.367-.064a1 1 0 0 1 1.297.655C10.022 23.35 10.854 24 11.81 24A2.1 2.1 0 0 0 13 23.632V4.334A3 3 0 0 0 11.624 4m4.617 0c1.383 0 2.583.82 3.139 2.018a1 1 0 0 0 .642.544c1.625.448 2.876 2.026 2.876 3.958a4.5 4.5 0 0 1-.099.923c-.174.754-.602 1.543-1.213 2.189-.758.802-1.693 1.274-2.586 1.274a1 1 0 1 0 0 2c1.455 0 2.772-.686 3.767-1.627.147.28.233.608.233.96 0 1.011-.697 1.791-1.527 1.934a1 1 0 0 0-.65 1.56c.148.21.239.474.239.768 0 .73-.543 1.262-1.117 1.262-.575 0-.833-.212-1.21-.547-.413-.367-.547-.725-.547-.882a1 1 0 0 0-2 0c0 .948.575 1.805 1.218 2.377.174.154.366.3.572.43a2.21 2.21 0 0 1-1.746.859A2.2 2.2 0 0 1 15 23.623V4.231A3.4 3.4 0 0 1 16.241 4" /></g></symbol>',28,28,!1,void 0),fe=_("Icon28InfoCircle","info_circle_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 28 28" id="info_circle_28"><path fill-rule="evenodd" d="M14 26c6.627 0 12-5.373 12-12S20.627 2 14 2 2 7.373 2 14s5.373 12 12 12m0-6a1 1 0 0 1-1-1v-6a1 1 0 1 1 2 0v6a1 1 0 0 1-1 1m0-9.8-.123-.006A1.2 1.2 0 0 1 14 7.8l.123.006A1.2 1.2 0 0 1 14 10.2" clip-rule="evenodd" /></symbol>',28,28,!1,void 0),he=_("Icon28SchoolOutline","school_outline_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 28 28" id="school_outline_28"><path fill="currentColor" fill-rule="evenodd" d="M14.637 6.104a2 2 0 0 0-1.274 0c-.17.057-.38.177-.724.483-.353.314-.774.754-1.39 1.402l-3.525 3.7A1 1 0 0 1 7 12H4v7c0 .717 0 1.194.03 1.56.03.356.081.518.133.621a1.5 1.5 0 0 0 .656.656c.103.052.265.103.62.132C5.806 22 6.283 22 7 22h3.5v-3.5a3.5 3.5 0 1 1 7 0V22H21c.717 0 1.194 0 1.56-.03.356-.03.518-.081.621-.133a1.5 1.5 0 0 0 .655-.656c.053-.103.104-.265.133-.62C24 20.194 24 19.717 24 19v-7h-3a1 1 0 0 1-.724-.31l-3.524-3.7c-.617-.649-1.038-1.09-1.39-1.403-.345-.306-.555-.426-.725-.483M15.5 18.5V22h-3v-3.5a1.5 1.5 0 0 1 3 0M7 24h14.04c.666 0 1.226 0 1.683-.037.48-.04.934-.124 1.366-.345a3.5 3.5 0 0 0 1.53-1.529c.22-.432.304-.887.344-1.366.037-.457.037-1.017.037-1.683v-8.08c0-.666 0-1.226-.037-1.683-.04-.48-.124-.934-.345-1.366a3.5 3.5 0 0 0-1.529-1.53c-.432-.22-.887-.305-1.366-.344C22.266 6 21.706 6 21.04 6h-3.423a18 18 0 0 0-.927-.908c-.438-.389-.883-.705-1.417-.884a4 4 0 0 0-2.546 0c-.534.18-.98.495-1.417.884-.28.25-.584.554-.927.908H6.96c-.666 0-1.226 0-1.683.037-.48.04-.934.124-1.366.344a3.5 3.5 0 0 0-1.53 1.53c-.22.432-.305.887-.344 1.366C2 9.734 2 10.294 2 10.96v8.08c0 .666 0 1.226.037 1.683.04.48.124.934.344 1.366a3.5 3.5 0 0 0 1.53 1.53c.432.22.887.304 1.366.344C5.734 24 6.294 24 6.96 24zm16.994-14a9 9 0 0 0-.025-.56c-.029-.356-.08-.518-.133-.621a1.5 1.5 0 0 0-.655-.656c-.103-.052-.265-.103-.62-.132C22.194 8 21.717 8 21 8h-1.476l1.905 2zM8.476 8H7c-.717 0-1.194 0-1.56.03-.356.03-.518.081-.621.133a1.5 1.5 0 0 0-.656.656c-.052.103-.103.265-.132.62-.013.162-.021.345-.025.561H6.57zM14 9a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3" clip-rule="evenodd" /></symbol>',28,28,!1,void 0);const pe=(e,a)=>e.length&&!a?e.map(((e,a)=>b(M,{mark:y[e],size:"s"},a))):a?b(M,{size:"s",mark:k[a]}):void 0,ve={display:"flex",gap:8,marginLeft:8},ge=e=>{if(!e||0===e.length)return null;let a=0,r=0;for(const o of e){const e=Number(y[o]);Number.isNaN(e)||(a+=e,r++)}if(0===r)return null;return Number((a/r).toFixed(2))},_e=b(se,{before:b(de,{}),children:"Нет оценок"}),be=({marks:e})=>e.length?b(se,{textWrap:"full",before:b(me,{}),style:{marginTop:5},after:ge(e),children:"Средний балл:"}):_e,ye=({marks:e})=>b("div",{style:{display:"flex"},children:e.map((({date:e,marks:a,absenceType:r})=>b("div",{style:ve,children:pe(a,r)},`${e}_${r}`)))}),Me=({marksForSubject:e})=>{if(!(null==e?void 0:e.daysWithMarksForSubject.length))return;const a=(e=>{const a={};for(const r of e.daysWithMarksForSubject){const{subjectName:e,daysWithMarks:o}=r;a[e]||(a[e]=[]);for(const r of o){const o={date:new Date(r.day).toLocaleDateString(),marks:r.markValues,absenceType:r.absenceType};a[e].push(o)}}return a})(e);return b(x,{mode:"plain",header:b(w,{mode:"secondary",children:"Оценки по дисциплинам"}),children:Object.keys(a).map(((e,r)=>b(U,{size:"l",children:b($,{mode:"shadow",children:[b(C,{children:b(j,{level:"3",Component:"h3",children:e})}),b(E,{children:b(ye,{marks:a[e]})}),b(be,{marks:a[e].flatMap((({marks:e})=>e))})]})},r)))})},ke=({markCounts:e,totalNumberOfMarks:a,averageMark:r})=>b(x,{header:b(w,{mode:"tertiary",children:["Статистика ",!e&&"отсутствует"]}),children:e?b(I.Fragment,{children:[b(se,{before:b(ce,{style:{marginTop:4}}),after:b(M,{color:"blueviolet",size:"s",mark:a}),children:"Суммарное количество оценок:"}),b(se,{before:b(ue,{style:{marginTop:4},width:20,height:20}),after:b(M,{size:"s",mark:r}),children:"Общий средний балл:"}),e&&b("div",{style:{display:"flex",flexDirection:"row-reverse",justifyContent:"space-around",gap:5},children:[2,3,4,5].map((a=>e[a]>0&&b(se,{before:b(M,{mark:a,size:"s"}),children:["x ",e[a]]},a)))})]}):void 0}),we={margin:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",padding:32},Ce=()=>{const[e,a]=S(!1),[r,o]=S({name:"",org:"",city:"",group:""});if(N((()=>{(async()=>{a(!0);const e=localStorage.getItem("data");if(e){const r=JSON.parse(e);if(r.name&&r.group)return o(r),void a(!1)}const r=localStorage.getItem("data"),t=JSON.parse(r);o({name:t.name||"",org:t.org||"",city:t.city||"",group:t.group||""}),localStorage.setItem("userData",JSON.stringify(r)),a(!1)})()}),[]),e)return b(C,{children:b(O,{})});const t=b(w,{mode:"tertiary",children:"Личная информация"});return b(x,{mode:"plain",header:t,children:[b(ee,{mode:"tint",style:we,children:[b(K,{size:96,src:Q}),b(j,{style:{marginBottom:8,marginTop:20},level:"2",weight:"2",Component:"h2",children:r.name}),b(z,{style:{marginBottom:24,color:"var(--vkui--color_text_secondary)"},children:["Студент (",r.group,")"]})]}),b(x,{mode:"plain",header:b(w,{mode:"tertiary",children:"Учебное заведение"}),children:b(A,{before:b(he,{}),subtitle:r.city,children:r.org})})]})},je=({id:e})=>{const[a,r]=S(!1),[o,t]=R(),[l,n]=J(),[i,s]=S(null),[c,d]=S(null),[m,u]=S(null),[f,h]=S(null),p=e=>{const a=(e=>{if(!e.daysWithMarksForSubject.length)return null;const a=e.daysWithMarksForSubject.reduce(((e,a)=>{if(a.daysWithMarks)for(const r of a.daysWithMarks)e.push(...r.markValues);return e}),[]),r=a.length,o=a.reduce(((e,a)=>e+Number(y[a])),0)/r,t={2:0,3:0,4:0,5:0};for(const e of a){const a=Number(y[e]);a>=2&&a<=5&&(t[a]+=1)}return{totalNumberOfMarks:r,averageMark:Number(o.toFixed(3)),markCounts:t}})(e);a&&(d(a.totalNumberOfMarks),u(a.averageMark),h(a.markCounts))},v=e=>{p(e),s(e),localStorage.setItem("lastFetchTime",String(Date.now())),localStorage.setItem("savedMarks",JSON.stringify(e))},g=async e=>{const a=localStorage.getItem("lastFetchTime"),o=localStorage.getItem("savedMarks");if(o&&(a||Date.now()-Number(a)>=H)&&!e){const e=o?JSON.parse(o):null;return v(e),void t({title:"Оценки взяты из кеша",onActionClick:()=>g(!0),action:"Загрузить новые",before:b(fe,{fill:T})})}try{r(!0);const e=await(async()=>{const e=localStorage.getItem("id");return D(`/performance.current/${e}`)})();if(G(e,(()=>{t({before:b(L,{fill:V}),title:"Ошибка при попытке загрузить оценки",action:"Попробовать снова",onActionClick:()=>g(!0)})}),n,r,t,!1),!("daysWithMarksForSubject"in e))return void localStorage.removeItem("savedMarks");v(e)}catch(e){}finally{r(!1)}};return N((()=>{g()}),[]),b(F,{nav:e,children:[b(P,{title:"Успеваемость"}),b(B,{onRefresh:()=>g(!0),isFetching:a,children:[b(q,{id:"UserInfo",children:b(Ce,{})}),a?b(x,{children:b(W,{})}):b(ke,{totalNumberOfMarks:c,averageMark:m,markCounts:f}),a?b(x,{children:b(W,{})}):b(q,{id:"MarksByGroup",children:b(Me,{marksForSubject:i})})]}),o,l]})};export{je as default};
