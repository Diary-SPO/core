import{h as e,p as t,u as a,D as r,G as i,am as l,H as s,q as n,s as o,r as c,B as d,L as h,P as m}from"./index-XyJYIhAT.js";import{P as p,B as f}from"./Placeholder-dIbI7TzN.js";import{C as g}from"./Card-SOVpxpsd.js";import{P as u}from"./PanelHeaderWithBack-Mte7KJTI.js";import{a as v}from"./colors-rNCG9YyA.js";import{m as S,h as k,I as y}from"./makeRequest-t21nFAea.js";import{u as j}from"./useSnackbar-Q4lCaM24.js";const C=({id:C})=>{const[P,w]=e(null),[A,I]=e(!1),[x,D]=e(!1),[F,b]=j(),B=()=>{I(!1),D(!0)},J=async e=>{I(!0);try{if(e){const e=await(async()=>S("/ads"))();if(k(e,B,B,I,b),e instanceof Response)return;(e=>{localStorage.setItem("savedAds",JSON.stringify(e)),localStorage.setItem("lastFetchTime",String(Date.now()))})(e),w(e)}else{const e=JSON.parse(localStorage.getItem("savedAds")||"");w(e)}I(!1)}catch(e){I(!1),b({before:a(y,{fill:v}),title:"Ошибка при попытке загрузить объявления",action:"Попробовать снова",onActionClick:()=>J(!0)})}};return t((()=>{const e=localStorage.getItem("savedAds");e?(w(JSON.parse(e)),b({title:"Данные взяты из кеша",action:"Загрузить новые",onActionClick:()=>J(!0)})):J(!0)}),[]),a(m,{nav:C,children:[a(u,{title:"Объявления"}),a(r,{children:[P&&(null==P?void 0:P.length)>0&&(null==P?void 0:P.map((({title:e,id:t,date:c,isForEmployees:d,isForParents:h,isForStudents:m,text:p})=>a(i,{description:a("div",{style:{display:"flex",gap:10},children:[d&&a(l,{children:"Для работников"}),h&&a(l,{color:"yellow-outline",children:"Для родителей"}),m&&a(l,{color:"green-outline",children:"Для студентов"})]}),header:a(s,{mode:"tertiary",children:new Date(c).toLocaleDateString()}),children:a(g,{mode:"shadow",children:a(r,{children:[a(n,{level:"3",Component:"h3",children:e}),a(o,{children:p})]})})},t)))),a(r,{children:A&&a(r,{children:a(c,{})})}),a(r,{children:x&&a(p,{header:"Ошибка при загрузке",action:a(f,{mode:"vertical",align:"center",children:[a(d,{size:"s",onClick:()=>J(!0),children:"Попробовать снова"}),a(h,{href:"https://vk.me/dnevnik_spo",target:"_blank",children:"Сообщить о проблеме"})]})})}),a(r,{children:P&&(null==P?void 0:P.length)<1&&a(p,{header:"Объявлений нет"})})]}),F]})};export{C as default};
