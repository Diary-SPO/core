import{m as t,u as e,B as r,L as n,h as a,T as s,p as i,I as o,E as u,a as c,b as l,_ as d,d as h,e as f,f as m,H as g,P as $,D,g as v,G as S,V as y}from"./index-XyJYIhAT.js";import{P as p}from"./PullToRefresh-F0PnwmxX.js";import{P as w}from"./PanelHeaderWithBack-Mte7KJTI.js";import{m as _,h as M}from"./makeRequest-t21nFAea.js";import{c as k,g as b}from"./_commonjsHelpers-uzQt2zA1.js";import{u as O}from"./useRateLimitExceeded-afZtobbp.js";import{u as L}from"./useSnackbar-Q4lCaM24.js";import{B as I,P as C}from"./Placeholder-dIbI7TzN.js";import"./colors-rNCG9YyA.js";var x={exports:{}};const j=b(x.exports=function(){var t=1e3,e=6e4,r=36e5,n="millisecond",a="second",s="minute",i="hour",o="day",u="week",c="month",l="quarter",d="year",h="date",f="Invalid Date",m=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,g=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,$={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(t){var e=["th","st","nd","rd"],r=t%100;return"["+t+(e[(r-20)%10]||e[r]||e[0])+"]"}},D=function(t,e,r){var n=String(t);return!n||n.length>=e?t:""+Array(e+1-n.length).join(r)+t},v={s:D,z:function(t){var e=-t.utcOffset(),r=Math.abs(e),n=Math.floor(r/60),a=r%60;return(e<=0?"+":"-")+D(n,2,"0")+":"+D(a,2,"0")},m:function t(e,r){if(e.date()<r.date())return-t(r,e);var n=12*(r.year()-e.year())+(r.month()-e.month()),a=e.clone().add(n,c),s=r-a<0,i=e.clone().add(n+(s?-1:1),c);return+(-(n+(r-a)/(s?a-i:i-a))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(t){return{M:c,y:d,w:u,d:o,D:h,h:i,m:s,s:a,ms:n,Q:l}[t]||String(t||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},S="en",y={};y[S]=$;var p="$isDayjsObject",w=function(t){return t instanceof b||!(!t||!t[p])},_=function t(e,r,n){var a;if(!e)return S;if("string"==typeof e){var s=e.toLowerCase();y[s]&&(a=s),r&&(y[s]=r,a=s);var i=e.split("-");if(!a&&i.length>1)return t(i[0])}else{var o=e.name;y[o]=e,a=o}return!n&&a&&(S=a),a||!n&&S},M=function(t,e){if(w(t))return t.clone();var r="object"==typeof e?e:{};return r.date=t,r.args=arguments,new b(r)},k=v;k.l=_,k.i=w,k.w=function(t,e){return M(t,{locale:e.$L,utc:e.$u,x:e.$x,$offset:e.$offset})};var b=function(){function $(t){this.$L=_(t.locale,null,!0),this.parse(t),this.$x=this.$x||t.x||{},this[p]=!0}var D=$.prototype;return D.parse=function(t){this.$d=function(t){var e=t.date,r=t.utc;if(null===e)return new Date(NaN);if(k.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var n=e.match(m);if(n){var a=n[2]-1||0,s=(n[7]||"0").substring(0,3);return r?new Date(Date.UTC(n[1],a,n[3]||1,n[4]||0,n[5]||0,n[6]||0,s)):new Date(n[1],a,n[3]||1,n[4]||0,n[5]||0,n[6]||0,s)}}return new Date(e)}(t),this.init()},D.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},D.$utils=function(){return k},D.isValid=function(){return!(this.$d.toString()===f)},D.isSame=function(t,e){var r=M(t);return this.startOf(e)<=r&&r<=this.endOf(e)},D.isAfter=function(t,e){return M(t)<this.startOf(e)},D.isBefore=function(t,e){return this.endOf(e)<M(t)},D.$g=function(t,e,r){return k.u(t)?this[e]:this.set(r,t)},D.unix=function(){return Math.floor(this.valueOf()/1e3)},D.valueOf=function(){return this.$d.getTime()},D.startOf=function(t,e){var r=this,n=!!k.u(e)||e,l=k.p(t),f=function(t,e){var a=k.w(r.$u?Date.UTC(r.$y,e,t):new Date(r.$y,e,t),r);return n?a:a.endOf(o)},m=function(t,e){return k.w(r.toDate()[t].apply(r.toDate("s"),(n?[0,0,0,0]:[23,59,59,999]).slice(e)),r)},g=this.$W,$=this.$M,D=this.$D,v="set"+(this.$u?"UTC":"");switch(l){case d:return n?f(1,0):f(31,11);case c:return n?f(1,$):f(0,$+1);case u:var S=this.$locale().weekStart||0,y=(g<S?g+7:g)-S;return f(n?D-y:D+(6-y),$);case o:case h:return m(v+"Hours",0);case i:return m(v+"Minutes",1);case s:return m(v+"Seconds",2);case a:return m(v+"Milliseconds",3);default:return this.clone()}},D.endOf=function(t){return this.startOf(t,!1)},D.$set=function(t,e){var r,u=k.p(t),l="set"+(this.$u?"UTC":""),f=(r={},r[o]=l+"Date",r[h]=l+"Date",r[c]=l+"Month",r[d]=l+"FullYear",r[i]=l+"Hours",r[s]=l+"Minutes",r[a]=l+"Seconds",r[n]=l+"Milliseconds",r)[u],m=u===o?this.$D+(e-this.$W):e;if(u===c||u===d){var g=this.clone().set(h,1);g.$d[f](m),g.init(),this.$d=g.set(h,Math.min(this.$D,g.daysInMonth())).$d}else f&&this.$d[f](m);return this.init(),this},D.set=function(t,e){return this.clone().$set(t,e)},D.get=function(t){return this[k.p(t)]()},D.add=function(n,l){var h,f=this;n=Number(n);var m=k.p(l),g=function(t){var e=M(f);return k.w(e.date(e.date()+Math.round(t*n)),f)};if(m===c)return this.set(c,this.$M+n);if(m===d)return this.set(d,this.$y+n);if(m===o)return g(1);if(m===u)return g(7);var $=(h={},h[s]=e,h[i]=r,h[a]=t,h)[m]||1,D=this.$d.getTime()+n*$;return k.w(D,this)},D.subtract=function(t,e){return this.add(-1*t,e)},D.format=function(t){var e=this,r=this.$locale();if(!this.isValid())return r.invalidDate||f;var n=t||"YYYY-MM-DDTHH:mm:ssZ",a=k.z(this),s=this.$H,i=this.$m,o=this.$M,u=r.weekdays,c=r.months,l=r.meridiem,d=function(t,r,a,s){return t&&(t[r]||t(e,n))||a[r].slice(0,s)},h=function(t){return k.s(s%12||12,t,"0")},m=l||function(t,e,r){var n=t<12?"AM":"PM";return r?n.toLowerCase():n};return n.replace(g,(function(t,n){return n||function(t){switch(t){case"YY":return String(e.$y).slice(-2);case"YYYY":return k.s(e.$y,4,"0");case"M":return o+1;case"MM":return k.s(o+1,2,"0");case"MMM":return d(r.monthsShort,o,c,3);case"MMMM":return d(c,o);case"D":return e.$D;case"DD":return k.s(e.$D,2,"0");case"d":return String(e.$W);case"dd":return d(r.weekdaysMin,e.$W,u,2);case"ddd":return d(r.weekdaysShort,e.$W,u,3);case"dddd":return u[e.$W];case"H":return String(s);case"HH":return k.s(s,2,"0");case"h":return h(1);case"hh":return h(2);case"a":return m(s,i,!0);case"A":return m(s,i,!1);case"m":return String(i);case"mm":return k.s(i,2,"0");case"s":return String(e.$s);case"ss":return k.s(e.$s,2,"0");case"SSS":return k.s(e.$ms,3,"0");case"Z":return a}return null}(t)||a.replace(":","")}))},D.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},D.diff=function(n,h,f){var m,g=this,$=k.p(h),D=M(n),v=(D.utcOffset()-this.utcOffset())*e,S=this-D,y=function(){return k.m(g,D)};switch($){case d:m=y()/12;break;case c:m=y();break;case l:m=y()/3;break;case u:m=(S-v)/6048e5;break;case o:m=(S-v)/864e5;break;case i:m=S/r;break;case s:m=S/e;break;case a:m=S/t;break;default:m=S}return f?m:k.a(m)},D.daysInMonth=function(){return this.endOf(c).$D},D.$locale=function(){return y[this.$L]},D.locale=function(t,e){if(!t)return this.$L;var r=this.clone(),n=_(t,e,!0);return n&&(r.$L=n),r},D.clone=function(){return k.w(this.$d,this)},D.toDate=function(){return new Date(this.valueOf())},D.toJSON=function(){return this.isValid()?this.toISOString():null},D.toISOString=function(){return this.$d.toISOString()},D.toString=function(){return this.$d.toUTCString()},$}(),O=b.prototype;return M.prototype=O,[["$ms",n],["$s",a],["$m",s],["$H",i],["$W",o],["$M",c],["$y",d],["$D",h]].forEach((function(t){O[t[1]]=function(e){return this.$g(e,t[0],t[1])}})),M.extend=function(t,e){return t.$i||(t(e,b,M),t.$i=!0),M},M.locale=_,M.isDayjs=w,M.unix=function(t){return M(1e3*t)},M.en=y[S],M.Ls=y,M.p={},M}());var H=t("Icon16ArrowLeftOutline","arrow_left_outline_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16" id="arrow_left_outline_16"><path fill-rule="evenodd" d="M6.47 3.22a.75.75 0 0 1 1.06 1.06L4.56 7.25h8.69a.75.75 0 0 1 0 1.5H4.56l2.97 2.97a.75.75 0 1 1-1.06 1.06L2.22 8.53a.75.75 0 0 1 0-1.06z" clip-rule="evenodd" /></symbol>',16,16,!1,void 0),T=t("Icon16ArrowRightOutline","arrow_right_outline_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16" id="arrow_right_outline_16"><path fill-rule="evenodd" d="M9.53 12.78a.75.75 0 0 1-1.06-1.06l2.97-2.97H2.75a.75.75 0 0 1 0-1.5h8.69L8.47 4.28a.75.75 0 0 1 1.06-1.06l4.25 4.25a.75.75 0 0 1 0 1.06z" clip-rule="evenodd" /></symbol>',16,16,!1,void 0);function Y(t,e=0){e%=7;const r=j(t),n=r.day(),a=(n<e?7:0)+n-e;return r.date(r.date()-a).toDate()}function N(t,e=0){const r=j(Y(t,e));return r.date(r.date()+6).toDate()}const A=t=>`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")}`,P=({onClick:t})=>e(C,{header:"Ошибка при загрузке",action:e(I,{mode:"vertical",align:"center",children:[e(r,{size:"s",onClick:()=>t(),children:"Попробовать снова"}),e(n,{href:"https://vk.me/dnevnik_spo",target:"_blank",children:"Сообщить о проблеме"})]})}),J={month:"short",day:"numeric",year:"numeric"},B=({handleGetLesson:t,startDate:n,endDate:c,showSnackbar:l,setStartDate:d,setEndDate:h})=>{const[f,m]=a(!1),g=((t,e,r,n,i)=>{const[o,u]=a(0),[c,l]=a(null),d=s(((a,s)=>{localStorage.setItem("isCurrent",JSON.stringify(!1)),r(!1);const c=new Date(t),l=new Date(e);if(o>0){const t=7*o;c.setDate(c.getDate()+t),l.setDate(l.getDate()+t),u(0)}else"prev"===a?(c.setDate(c.getDate()-7),l.setDate(l.getDate()-7)):"next"===a&&(c.setDate(c.getDate()+7),l.setDate(l.getDate()+7));s(c,l),n(c),i(l)}),[o,t,e,r,n,i]);return{handleButtonClick:(t,e)=>{u((t=>t+1)),c&&clearTimeout(c);const r=setTimeout((()=>{d(t,e),u(0)}),500);l(r)}}})(n,c,m,d,h),{handleButtonClick:$}=g,D=new Date;i((()=>{const t=Y(n),e=Y(D);if(t.toLocaleString("default",J)===e.toLocaleString("default",J))return localStorage.setItem("isCurrent",JSON.stringify(!0)),localStorage.setItem("currentDate",n.toString()),void m(!0);localStorage.setItem("isCurrent",JSON.stringify(!1)),localStorage.setItem("currentDate",n.toString()),m(!1)}),[n]);return e(I,{style:{alignItems:"center",position:"relative",color:"var(--vkui--color_stroke_accent_themed)"},gap:"s",children:[e(o,{"aria-label":"Prev",onClick:()=>$("prev",t),children:e(H,{})}),e("div",{style:{display:"flex",alignItems:"center"},children:[e(r,{size:"m",mode:"secondary",onClick:()=>(async()=>{const e=Y(D),r=Y(n),a=N(D);if(e.toLocaleString("default",J)===r.toLocaleString("default",J))return l({title:"Вы уже на текущей неделе"}),localStorage.setItem("isCurrent",JSON.stringify(!0)),void m(!0);try{t(e,a),d(e),h(a),localStorage.setItem("isCurrent",JSON.stringify(!0)),m(!0)}catch(t){}})(),disabled:f,children:"Домой"}),e(u,{tooltipContent:"Вернёт вас на текущую неделю"})]}),e(o,{"aria-label":"Next",onClick:()=>$("next",t),children:e(T,{})})]})},W=l((()=>d((()=>import("./index-ozmxx0_M.js")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])))),E=l((()=>d((()=>import("./index-s2SYev3e.js")),__vite__mapDeps([11,1,2,12,13,14,15,16,17,18,19])))),F=({id:t})=>{const r=new Date,n=new Date(localStorage.getItem("currentDate")),s=n&&n.getFullYear()>=2023?n:r,[o,u]=a(N(s)),[l,d]=a(),[k,b]=a(Y(s)),{panel:I,panelsHistory:C}=h(),x=f(),[j,H]=a(!1),[T,J]=a(!1),[F,R]=O(),[z,V]=L(),U=async(t,e)=>{H(!0),localStorage.setItem("currentDate",k.toString());try{const r=await(async(t,e)=>{const r=localStorage.getItem("id"),n=A(t),a=A(e);return _(`/lessons/${r}/${n}/${a}`)})(t,e);if(M(r,(()=>{H(!1),J(!0)}),R,H,V),r instanceof Response)return;d(r),localStorage.setItem("savedLessons",JSON.stringify(r))}catch(t){}finally{H(!1)}},G=()=>{Z(!0)},Z=async t=>{const e=localStorage.getItem("savedLessons");if(e&&!(()=>{const t=localStorage.getItem("lastFetchTime");return!t||Date.now()-Number(t)>c})()&&!t)return V({layout:"vertical",action:"Загрузить новые",onActionClick:G,title:"Данные взяты из кеша"}),void d(JSON.parse(e));await U(k,o)};i((()=>{Z()}),[]);const q=((t,e)=>`\n  ${t.getDate()}\n  ${t.toLocaleString("default",{month:"long"}).slice(0,3)}\n    -\n    ${e.getDate()}\n    ${e.toLocaleString("default",{month:"long"}).slice(0,3)}`)(k,o),Q=(null==l?void 0:l.length)&&!(null==l?void 0:l.some((t=>{var e;return null==(e=t.lessons)?void 0:e.some((t=>{var e,r;return null==(r=null==(e=t.gradebook)?void 0:e.tasks)?void 0:r.some((t=>t.mark))}))}))),K=e(B,{handleGetLesson:U,showSnackbar:V,endDate:o,startDate:k,setEndDate:u,setStartDate:b}),X=j&&e(m,{}),tt=X||e(W,{lessonsState:l}),et=X||e(E,{lessonsState:l}),rt=e(g,{mode:"secondary",children:["Оценки за неделю ",Q&&"отсутствуют"]});return e(y,{id:t,history:C,activePanel:I,onSwipeBack:()=>x.back(),children:e($,{nav:t,children:[e(w,{title:"Главная"}),T&&e(P,{onClick:G}),e(p,{onRefresh:G,isFetching:j,children:e(D,{children:[e(v,{id:"MarksByDay",children:e(S,{header:rt,children:tt})}),e(v,{id:"ScheduleGroup",mode:"screen",children:e(S,{header:e(g,{aside:K,mode:"secondary",style:"align-items: center;",children:q}),children:et})})]})}),z,F]})})};export{F as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/index-ozmxx0_M.js","assets/index-XyJYIhAT.js","assets/index-9d2Qwq0S.css","assets/HorizontalScroll-pkeOEJmx.js","assets/Avatar-J1FZQEiI.js","assets/Avatar-_NcDAd4Z.css","assets/chevron_24-u9G6Q-o1.js","assets/HorizontalScroll-hbQP3bcj.css","assets/Caption-crA2LuIN.js","assets/Caption-ZGkJl_LD.css","assets/index-UOXuefWs.css","assets/index-s2SYev3e.js","assets/CardGrid-pEh1ThRX.js","assets/CardGrid-hRHHs9oZ.css","assets/colors-rNCG9YyA.js","assets/colors-6YfMoe5F.css","assets/Card-SOVpxpsd.js","assets/Card-4neL39Cp.css","assets/Placeholder-dIbI7TzN.js","assets/Placeholder-haIpdQCF.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
