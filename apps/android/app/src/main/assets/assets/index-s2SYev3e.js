var e=Object.defineProperty,s=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,r=(s,l,t)=>l in s?e(s,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[l]=t;import{u as o,am as i,aJ as d,A as c,aw as m,M as u,S as p,F as y,H as h,ax as v,e as f,aK as b,T as g,aL as D,J as T,G as x}from"./index-XyJYIhAT.js";import{C as w}from"./CardGrid-pEh1ThRX.js";import{b as k,c as j,V as N}from"./colors-rNCG9YyA.js";import{C as O}from"./Card-SOVpxpsd.js";import{P as $}from"./Placeholder-dIbI7TzN.js";const C=(e,s)=>{const[l,t]=e.split(":").map(Number);if(Number.isNaN(l)||Number.isNaN(t)||l<0||l>23||t<0||t>59)return null;const a=new Date(s);return a.setHours(l),a.setMinutes(t),a},S={margin:"5px 0",display:"inline-block",padding:"3px 5px",borderRadius:"5px"},I=({lessonDate:e,startTime:i,endTime:d})=>{if(!e||!i||!d)return null;const c=new Date,m=C(d,e),u=C(i,e);if(!m)return null;const p=((e,s,l)=>{const t=(l.getTime()-e.getTime())/6e4;if(t>90||e>s)return null;if(e<l)return`${Math.floor(t)} мин до начала`;if(e<s){const l=(s.getTime()-e.getTime())/6e4;return`${Math.floor(l)} мин до конца`}})(c,m,u);if(!p)return null;const y=parseInt(p,10)<30?k:j,h=(v=((e,s)=>{for(var l in s||(s={}))a.call(s,l)&&r(e,l,s[l]);if(t)for(var l of t(s))n.call(s,l)&&r(e,l,s[l]);return e})({},S),s(v,l({border:`1px solid ${y}`,color:y})));var v;return o("div",{style:h,children:p})},L=({gradebook:e,lessonDate:s,startTime:l,endTime:t})=>o("div",{children:[o("div",{style:{display:"flex",alignItems:"center"},children:[(null==e?void 0:e.lessonType)&&o(i,{style:{margin:"5px 5px 5px 0px"},children:d[null==e?void 0:e.lessonType]}),(null==e?void 0:e.absenceType)&&o(i,{color:"IsLate"===e.absenceType?"yellow":"red",children:c[null==e?void 0:e.absenceType]})]}),o(I,{lessonDate:s,startTime:l,endTime:t})]}),M=({lessonDate:e,lesson:s,handleLessonClick:l})=>{var t,a,n,r,i,d;const{name:c,endTime:y,startTime:h,timetable:v,gradebook:f}=s;if(!c)return;const b=h?`${h} — ${y}, каб. ${0===Number(null==(t=null==v?void 0:v.classroom)?void 0:t.name)?"ДО":null==(a=null==v?void 0:v.classroom)?void 0:a.name}`:"Нет данных",g=(null==v?void 0:v.teacher)?`${null==(n=v.teacher)?void 0:n.lastName} ${null==(r=v.teacher)?void 0:r.firstName[0]}. ${null==(i=v.teacher)?void 0:i.middleName[0]}.`:"Не указан";return o(p,{className:"lesson",onClick:()=>l(c,y,h,v,f),subtitle:o("div",{children:[o("div",{style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[o(L,{gradebook:f,lessonDate:e,startTime:h,endTime:y}),o("div",{style:{display:"flex",gap:5},children:null==(d=null==f?void 0:f.tasks)?void 0:d.map(((e,s)=>(e.isRequired||m(e))&&o(u,{mark:m(e),size:"s"},s)))})]}),o("div",{children:b}),o("div",{children:g})]}),children:c},h)},P=({lessonDayOfWeek:e,formattedLessonDate:s,displayDayStyles:l,displayDay:t})=>o(h,{mode:"secondary",aside:t&&o(y,{style:l,children:t}),children:[e," ",s]}),R=v((({lesson:e})=>{const s=f(),{setData:l}=b(),t=g(((e,t,a,r,o)=>{s.showModal(D);const i=n.toISOString(),d={name:e,endTime:t,startTime:a,timetable:r,gradebook:o,tasks:null==o?void 0:o.tasks,lessonId:i};l(d)}),[]),a=new Date,n=new Date(e.date),r=(i=e.date,new Date(i).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}));var i;const d=n.toLocaleString("default",{weekday:"long"}),c=(e=>{const s=new Date;return e.getDate()===s.getDate()&&e.getMonth()===s.getMonth()&&e.getFullYear()===s.getFullYear()})(n),m={color:c?N:void 0,padding:"3px 5px",borderRadius:"5px",border:`1px solid ${c?N:"#888888"}`},u=c?"Сегодня":a>n?" День завершён":void 0,p=T((()=>e.lessons&&e.lessons.length>0?e.lessons.map((e=>o(M,{lessonDate:n,lesson:e,handleLessonClick:t},e.lessonId))):o($,{children:"Пар нет"})),[e.lessons,n,t]);return o(O,{className:"lessonCard",children:o(x,{header:o(P,{lessonDayOfWeek:d,formattedLessonDate:r,displayDayStyles:m,displayDay:u}),children:p})},e.date)})),F=v((({lessonsState:e})=>o(w,{style:{overflowY:"auto"},size:"l",spaced:!0,children:(null==e?void 0:e.length)&&(null==e?void 0:e.map(((e,s)=>o(R,{lesson:e},`${e.date}_${s}`))))})));export{F as default};
